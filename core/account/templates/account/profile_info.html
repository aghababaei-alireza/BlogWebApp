{% extends "account/base.html" %}
{% load static %}

{% block title %}Profile Info{% endblock title %}

{% block script %}
<script src="https://www.google.com/recaptcha/api.js" async defer></script>
<link href="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.13/cropper.min.css" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.13/cropper.min.js"></script>
{% endblock script %}

{% block content %}
<form class="account_form" action="." method="post" enctype="multipart/form-data">
    {% csrf_token %}
    <h2>Profile Info</h2>
    <div class="form_section">
        <label for="email">Email</label>
        <input style="background-color:#ddd;" type="email" id="email" name="email" value="{{ form.email.value }}" readonly>
        {% if form.email.errors %}
            <ul class="error_list">
                {% for error in form.email.errors %}
                    <li class="error">{{ error }}</li>
                {% endfor %}
            </ul>
        {% endif %}
    </div>
    <div class="form_section">
        <label for="username">Username</label>
        <input type="username" id="username" name="username" required value="{{ form.username.value }}">
        {% if form.new_password1.errors %}
            <ul class="error_list">
                {% for error in form.new_password1.errors %}
                    <li class="error">{{ error }}</li>
                {% endfor %}
            </ul>
        {% endif %}
    </div>

    <div class="form_section">
        <label for="image-input">Profile Image</label>
        <img id="crop-preview" src="{% if request.user.image %}{{ request.user.image.url }}{% endif %}" style="max-width: 300px;">
        <input type="file" id="image-input" name="image-input" accept="image/*">
        <input type="hidden" name="cropped_image_data" id="cropped_image_data">
    </div>
    {% if request.user.image %}
    <div class="form_section_h">
        <input type="checkbox" name="delete_image" id="delete_image">
        <label for="delete_image">Delete current profile image</label>
    </div>
    {% endif %}
    
    <div class="form_section">
        <input type="submit" value="Update">
    </div>
    <div class="form_section">
        {% if form.non_field_errors %}
            <ul class="error_list">
                {% for error in form.non_field_errors %}
                    <li class="error">{{ error }}</li>
                {% endfor %}
            </ul>
        {% endif %}
    </div>
</form>
{% endblock content %}

{% block extra_js %}
<script src="{% static "account/js/profile_info_scripts.js" %}"></script>
{% endblock extra_js %}