{% extends "base.html" %}
{% load static %}
{% load blog_extras %}

{% block title %}Posts{% endblock title %}

{% block extra_css %}
<link rel="stylesheet" href="{% static "blog/css/posts.css" %}">
{% endblock extra_css %}

{% block script %}
{% endblock script %}

{% block content %}
{% for post in posts %}
<div class="post_container" {% if post.category %}style="border-left: 5px solid {{ post.category.color }}"{% endif %} onclick="show_detail('{% url 'post:detail' pk=post.pk %}')">
    <div class="post_header">
        <div class="post_header_section">
            <img class="image" src="{% if post.author.image %}{{ post.author.image.url }}{% else %}{% static "img/profile.png" %}{% endif %}" alt="{{ post.author.username }}" width="48" height="48">
            <div class="author_info">
                <h4>{{ post.author.username }}</h4>
                <h6>{{ post.author.email }}</h6>
            </div>
            <p class="category_badge" style="background-color: {{ post.category.color }};">{{ post.category.name }}</p>
            <div class="author_info">
                <small>Published: {{ post.created_at|date_format }}</small>
                {% comment %} {% if post.updated_at|add -post.created_at <= 1 %}
                <small>Edited: {{ post.updated_at }}</small>
                {% endif %} {% endcomment %}
            </div>
        </div>

        {% if post.author == request.user %}
        <div class="post_header_section" >
            <a href="{% url "post:update" pk=post.pk %}">
                <img class="action_button" src="{% static "blog/img/edit.svg" %}" title="Edit"></img>
            </a>
            <button class="action_button" style="background-image: url({% static "blog/img/delete.svg" %});" title="Delete" onclick="delete_post('{% url 'post:delete' pk=post.pk %}')"></button>
        </div>
        {% endif %}
    </div>

    <div class="post_content">
        <h3>{{ post.title }}</h3>
        <p>{{ post.content }}</p>
        {% if post.image %}
        <img src="{{ post.image.url }}" alt="{{ post.title }}">
        {% endif %}
    </div>

    <form action="{% url "comment:create" post_pk=post.pk %}" method="post" class="post_footer">
        {% csrf_token %}
        <img src="{% if request.user.image %}{{ request.user.image.url }}{% else %}{% static "img/profile.png" %}{% endif %}" alt="" class="small_image" width="24" height="24">
        <textarea name="content" id="content" rows="1" placeholder="Comment..." onclick="event.stopPropagation();"></textarea>
        <input type="submit" style="background-image: url('{% static 'blog/img/send.svg' %}');" value="" title="Send">
        <a href="{% url "post:detail" pk=post.pk %}#comments"><p>{{ post.comments.all|length }} comment{{ post.comments.all|length|pluralize }}</p></a>
    </form>
</div>
{% endfor %}

<form method="post" id="delete_form" class="modal hidden">
    {% csrf_token %}
    <p>Are you sure you want to delete this post?</p>
    <div class="form_section_h">
        <input type="submit" value="Delete" class="btn" style="background-color: red;">
        <button type="button" onclick="close_delete_modal()" class="btn">Cancel</button>
    </div>
</form>
{% endblock content %}

{% block extra_js %}
<script src="{% static "blog/js/posts.js" %}"></script>
{% endblock extra_js %}